<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		 xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<artifactId>splice_machine_test-cloudera-cdh4.5.0</artifactId>
	<packaging>jar</packaging>
	<name>${project.artifactId}</name>
	<description>Splice Machine Test</description>

	<parent>
		<artifactId>spliceengine-cloudera-cdh4.5.0</artifactId>
		<groupId>com.splicemachine</groupId>
		<version>1.0.0RC2-SNAPSHOT</version>
	</parent>

	<dependencies>
		<dependency> <groupId>com.splicemachine</groupId> <artifactId>splice_machine_adapter_94-cloudera-cdh4.5.0</artifactId> <version>1.0.0RC2-SNAPSHOT</version></dependency>
	</dependencies>

	<profiles>

		<profile>
			<id>assemble</id>
			<build>
				<plugins>
					<plugin>
						<artifactId>maven-assembly-plugin</artifactId>
						<version>2.4.1</version>
						<configuration>
							<archive>
								<manifestEntries>
									<Implementation-Version>${buildNumber}</Implementation-Version>
									<Release>${project.version}</Release>
									<Build-Time>${maven.build.timestamp}</Build-Time>
									<URL>http://www.splicemachine.com</URL>
								</manifestEntries>
							</archive>
							<descriptors>
								<descriptor>${project.basedir}/src/main/assembly/assembly.xml</descriptor>
								<descriptor>${project.basedir}/src/main/assembly/simple_assembly.xml</descriptor>
							</descriptors>
							<attach>true</attach>
						</configuration>
						<executions>
							<execution>
								<phase>package</phase>
								<id>simple</id>
								<goals>
									<goal>single</goal>
								</goals>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
		</profile>

		<profile>
			<id>spliceZoo</id>
			<activation>
				<property>
					<name>zoo</name>
				</property>
			</activation>
			<build>
				<plugins>
					<plugin>
						<artifactId>maven-clean-plugin</artifactId>
						<version>2.5</version>
						<executions>
							<execution>
								<goals>
									<goal>clean</goal>
								</goals>
							</execution>
						</executions>
						<configuration>
							<excludeDefaultDirectories>true</excludeDefaultDirectories>
							<filesets>
								<fileset>
									<directory>${project.build.directory}/hbase</directory>
									<includes>
										<include>**/*</include>
									</includes>
								</fileset>
								<fileset>
									<directory>${project.build.directory}/zookeeper</directory>
									<includes>
										<include>**/*</include>
									</includes>
								</fileset>
							</filesets>
						</configuration>
					</plugin>
					<plugin>
						<groupId>org.codehaus.mojo</groupId>
						<artifactId>exec-maven-plugin</artifactId>
						<version>1.3.2</version>
						<executions>
							<execution>
								<goals>
									<goal>exec</goal>
								</goals>
							</execution>
						</executions>
						<configuration>
							<classpathScope>compile</classpathScope>
							<executable>java</executable>
							<arguments>
								<argument>-cp</argument>
								<classpath>${maven.runtime.classpath}</classpath>
								<argument>-Djava.awt.headless=true</argument>
								<argument>
									-Dlog4j.configuration=file:${basedir}/src/main/resources/info-log4j.properties
								</argument>
								<argument>-Djava.net.preferIPv4Stack=true</argument>
								<argument>-Dzookeeper.sasl.client=false</argument>
								<argument>-Xmx2g</argument>
								<argument>-Xms1g</argument>
								<argument>-XX:MaxPermSize=256M</argument>
								<argument>-XX:+CMSClassUnloadingEnabled</argument>
								<argument>-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=4002</argument>
								<argument>org.apache.zookeeper.server.ZooKeeperServerMain</argument>
								<argument>2181</argument>
								<argument>${project.build.directory}/zookeeper</argument>
								<argument>10</argument>
								<argument>0</argument>
							</arguments>
						</configuration>
					</plugin>
				</plugins>
			</build>
		</profile>

		<profile>
			<id>spliceClusterMember</id>
			<activation>
				<property>
					<name>spliceClusterMember</name>
				</property>
			</activation>
			<properties>
				<memberNumber>1</memberNumber>
			</properties>
			<build>
				<plugins>
					<plugin>
						<groupId>org.codehaus.mojo</groupId>
						<artifactId>exec-maven-plugin</artifactId>
						<version>1.3.2</version>
						<executions>
							<execution>
								<goals>
									<goal>exec</goal>
								</goals>
							</execution>
						</executions>
						<configuration>
							<classpathScope>compile</classpathScope>
							<executable>java</executable>
							<arguments>
								<argument>-cp</argument>
								<classpath>${maven.runtime.classpath}</classpath>
								<argument>-Djava.awt.headless=true</argument>
								<argument>-Dlog4j.configuration=${log4j.config.uri}</argument>
								<argument>-Djava.net.preferIPv4Stack=true</argument>
								<argument>-Xmx2g</argument>
								<argument>-Xmn128m</argument>
								<argument>-XX:+UseConcMarkSweepGC</argument>
								<argument>-XX:+UseParNewGC</argument>
								<argument>-XX:NewSize=128m</argument>
								<argument>-XX:MaxNewSize=128m</argument>
								<argument>-XX:CMSInitiatingOccupancyFraction=70</argument>
								<argument>-XX:+UseCMSInitiatingOccupancyOnly</argument>
								<argument>-XX:MaxGCPauseMillis=100</argument>
								<argument>-XX:MaxPermSize=256M</argument>
								<argument>-XX:+CMSClassUnloadingEnabled</argument>
								<argument>-XX:MaxDirectMemorySize=1g</argument>
								<argument>com.splicemachine.test.SpliceTestClusterParticipant</argument>
								<argument>${project.build.directory}/hbase</argument>
								<argument>${memberNumber}</argument>
							</arguments>
						</configuration>
					</plugin>
				</plugins>
			</build>
		</profile>

		<profile>
			<id>spliceFast</id>
			<activation>
				<property>
					<name>spliceFast</name>
				</property>
			</activation>
			<build>
				<plugins>
					<plugin>
						<groupId>org.codehaus.mojo</groupId>
						<artifactId>exec-maven-plugin</artifactId>
						<version>1.3.2</version>
						<executions>
							<execution>
								<goals>
									<goal>exec</goal>
								</goals>
							</execution>
						</executions>
						<configuration>
							<classpathScope>compile</classpathScope>
							<executable>java</executable>
							<arguments>
								<!-- <argument>-verbose:gc</argument> -->
								<argument>-cp</argument>
								<classpath>${maven.runtime.classpath}</classpath>
								<argument>-Xdebug</argument>
								<argument>-Dlog4j.configuration=${log4j.config.uri}</argument>
								<argument>-Djava.net.preferIPv4Stack=true</argument>
								<argument>-Djava.awt.headless=true</argument>
								<argument>-Dzookeeper.sasl.client=false</argument>
								<argument>-Dcom.sun.management.jmxremote.ssl=false</argument>
								<argument>-Dcom.sun.management.jmxremote.authenticate=false</argument>
								<argument>-Dcom.sun.management.jmxremote.port=10102</argument>
								<argument>-Dsplice.authentication=NATIVE</argument>
								<argument>-Xmx8g</argument>
								<argument>-Xms1g</argument>
								<argument>-Xmn128m</argument>
								<argument>-XX:+UseConcMarkSweepGC</argument>
								<argument>-XX:+UseParNewGC</argument>
								<argument>-XX:NewSize=128m</argument>
								<argument>-XX:MaxNewSize=128m</argument>
								<argument>-XX:CMSInitiatingOccupancyFraction=70</argument>
								<argument>-XX:+UseCMSInitiatingOccupancyOnly</argument>
								<argument>-XX:MaxGCPauseMillis=100</argument>
								<argument>-XX:MaxPermSize=256M</argument>
								<argument>-XX:+CMSClassUnloadingEnabled</argument>
								<argument>-XX:MaxDirectMemorySize=1g</argument>
								<argument>-enableassertions</argument>
								<argument>-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=4000</argument>
								<!-- Setting the updateSystemProcs option to true causes all of the system stored procedures to be re-created on server startup. -->
								<argument>-Dderby.language.updateSystemProcs=false</argument>
								<!-- Setting the logStatementText option to true enables logging of all statements. -->
								<argument>-Dderby.language.logStatementText=false</argument>
								<argument>com.splicemachine.test.SpliceTestPlatform</argument>
								<argument>file://${project.build.directory}/hbase</argument>
								<argument>60000</argument>
								<argument>60010</argument>
								<argument>60020</argument>
								<argument>60030</argument>
								<argument>1527</argument>
								<argument>${failTasksRandomly}</argument>
							</arguments>
						</configuration>
					</plugin>
				</plugins>
			</build>
		</profile>

		<profile>
			<id>spliceWait</id>
			<build>
				<plugins>
					<plugin>
						<groupId>org.codehaus.mojo</groupId>
						<artifactId>exec-maven-plugin</artifactId>
						<version>1.3.2</version>
						<executions>
							<execution>
								<goals>
									<goal>java</goal>
								</goals>
							</execution>
						</executions>
						<configuration>
							<mainClass>com.splicemachine.test.SpliceTestPlatformWait</mainClass>
							<arguments>
								<argument>localhost</argument>
								<argument>1527</argument>
							</arguments>
						</configuration>
					</plugin>
				</plugins>
			</build>
		</profile>

		<profile>
			<id>ij</id>
			<activation>
				<property>
					<name>ij</name>
				</property>
			</activation>
			<properties>
				<!-- Override from command line with -Dij.connection.port=1528 -->
				<ij.connection.port>1527</ij.connection.port>
			</properties>
			<build>
				<plugins>
					<plugin>
						<groupId>org.codehaus.mojo</groupId>
						<artifactId>exec-maven-plugin</artifactId>
						<version>1.3.2</version>
						<executions>
							<execution>
								<goals>
									<goal>java</goal>
								</goals>
							</execution>
						</executions>
						<configuration>
							<systemProperties>
								<systemProperty>
									<key>ij.connection.splice</key>
									<value>
										jdbc:splice://localhost:${ij.connection.port}/splicedb;user=splice;password=admin
									</value>
								</systemProperty>
							</systemProperties>
							<mainClass>org.apache.derby.tools.ij</mainClass>
							<includeProjectDependencies>true</includeProjectDependencies>
							<executable>maven</executable>
						</configuration>
					</plugin>
				</plugins>
			</build>
		</profile>

	</profiles>

</project>
