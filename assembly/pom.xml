<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright (c) 2012 - 2019 Splice Machine, Inc.
  ~
  ~ This file is part of Splice Machine.
  ~ Splice Machine is free software: you can redistribute it and/or modify it under the terms of the
  ~ GNU Affero General Public License as published by the Free Software Foundation, either
  ~ version 3, or (at your option) any later version.
  ~ Splice Machine is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
  ~ without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
  ~ See the GNU Affero General Public License for more details.
  ~ You should have received a copy of the GNU Affero General Public License along with Splice Machine.
  ~ If not, see <http://www.gnu.org/licenses/>.
  -->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <artifactId>splice_machine-assembly</artifactId>
    <packaging>jar</packaging>
    <name>${project.artifactId}</name>
    <description>Assembly module for SpliceMachine</description>
    <parent>
        <artifactId>spliceengine-parent</artifactId>
        <groupId>com.splicemachine</groupId>
        <version>3.1.0.1943-SNAPSHOT</version>
    </parent>
    <dependencies>
        <dependency>
            <!-- Get all projects and required dependencies transitively -->
            <groupId>${project.groupId}</groupId>
            <artifactId>hbase_sql</artifactId>
            <version>${project.version}</version>
            <classifier>${envClassifier}</classifier>
        </dependency>
        <dependency>
            <groupId>${project.groupId}</groupId>
            <artifactId>splice_spark</artifactId>
            <version>${project.version}</version>
            <classifier>${envClassifier}</classifier>
        </dependency>
        <dependency>
            <groupId>${project.groupId}</groupId>
            <artifactId>spark_sql</artifactId>
            <version>${project.version}</version>
            <classifier>${envClassifier}</classifier>
        </dependency>
    </dependencies>
    <properties>
        <jenkins.build.number>1</jenkins.build.number>
        <parcel.patch>p0.${jenkins.build.number}</parcel.patch>
        <commonArtifacts>
            db-client,
            db-tools-i18n,
            db-tools-ij,
            db-shared,
            db-drda,
            db-engine,
            pipeline_api,
            spark_sql,
            splice_access_api,
            splice_encoding,
            splice_machine,
            splice_protocol,
            splice_si_api,
            splice_timestamp_api,
            utilities,
            memory,
            sketches-core,
            opencsv,
            concurrentlinkedhashmap-lru,
            kryo-serializers,
            lucene-core,
	    scala_util,
            hbase_pipeline,
            hbase_storage,
            hbase_sql,
            splice_ee,
            splice_backup,
            splice_replication,
            splice_auth,
            splice_colperms,
            splice_encryption,
            akka-remote_${scala.binary.version},
            splice_spark,
            super-csv,
            c3p0,
            mchange-commons-java,
            splice_aws,
            units,
            log,
            stats,
            HdrHistogram,
            jmxutils,
            jol-core,
            slice,
            orc-protobuf,
            spark-avro_2.11,
            jython-standalone
        </commonArtifacts>
    </properties>
    <build>
        <plugins>
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>build-helper-maven-plugin</artifactId>
                <version>1.9.1</version>
                <executions>
                    <execution>
                        <id>add-resource</id>
                        <phase>generate-resources</phase>
                        <goals>
                            <goal>add-resource</goal>
                        </goals>
                        <configuration>
                            <resources>
                                <resource>
                                    <directory>${envClassifier}/src/main/resources</directory>
                                    <filtering>true</filtering>
                                </resource>
                            </resources>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <artifactId>maven-deploy-plugin</artifactId>
                <configuration>
                    <skip>true</skip>
                </configuration>
            </plugin>
        </plugins>
    </build>

    <profiles>
        <profile>
            <id>ee</id>
            <activation>
                <property>
                    <name>ee</name>
                    <value>enterprise</value>
                </property>
            </activation>
            <dependencies>
                <dependency>
                    <groupId>com.splicemachine</groupId>
                    <artifactId>spliceengine-ee-assembly</artifactId>
                    <version>${project.version}</version>
                    <classifier>${envClassifier}</classifier>
                </dependency>
            </dependencies>
        </profile>
        <profile>
            <id>parcel</id>
            <activation>
                <property>
                    <name>parcel</name>
                    <value>parcel</value>
                </property>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>copy</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>copy-dependencies</goal>
                                </goals>
                                <configuration>
                                    <includeArtifactIds>
                                        ${commonArtifacts},
                                        splice_sentry
                                    </includeArtifactIds>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions>
                            <execution>
                                <phase>pre-integration-test</phase>
                                <configuration>
                                    <target>
                                        <replace token="TOP_VERSION" value="${project.version}.${envClassifier}.${parcel.patch}" dir="target/classes/meta">
                                            <include name="parcel.json"/>
                                        </replace>
                                        <replace token="BASE_VERSION" value="${project.version}" dir="target/classes/meta">
                                            <include name="parcel.json"/>
                                        </replace>
                                        <replace token="COMPONENT_VERSION" value="${project.version}.${envClassifier}" dir="target/classes/meta">
                                            <include name="parcel.json"/>
                                        </replace>
                                        <replace token="PKG_VERSION" value="${project.version}+${envClassifier}+${buildNumber}" dir="target/classes/meta">
                                            <include name="parcel.json"/>
                                        </replace>
                                        <replace token="PKG_RELEASE" value="1.${envClassifier}.${parcel.patch}" dir="target/classes/meta">
                                            <include name="parcel.json"/>
                                        </replace>
                                        <replace token="CDH_VERSION" value="${cdh.parcel.version}" dir="target/classes/meta">
                                            <include name="parcel.json"/>
                                        </replace>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib">
                                            <fileset dir="target/dependency" includes="**/*"/>
                                        </copy>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta">
                                            <fileset dir="target/classes/meta" includes="**/*"/>
                                        </copy>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf">
                                            <fileset dir="target/classes/conf" includes="**/*"/>
                                        </copy>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin">
                                            <fileset dir="common/src/main/resources/bin" includes="sqlshell.sh"/>
                                        </copy>
                                        <replace token="##SPLICELIBDIR##" value="${splice.lib.dir}" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin">
                                            <include name="sqlshell.sh"/>
                                        </replace>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts">
                                            <fileset dir="target/classes/scripts" includes="**/*" excludes="**/flatten.sh,**/restart.sh" />
                                            <fileset dir="common/src/main/resources/scripts" includes="**/*"/>
                                        </copy>
                                        <!-- el6 -->
                                        <replace token="FULL_VERSION" value="${project.version}.${envClassifier}.${parcel.patch}-el6" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta">
                                            <include name="parcel.json"/>
                                        </replace>
                                        <tar compression="gzip" destfile="target/parcels/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}-el6.parcel">
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin"/>
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf"/>
                                        </tar>
                                        <!-- el7 -->
                                        <replace token="el6" value="el7" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta">
                                            <include name="parcel.json"/>
                                        </replace>
                                        <tar compression="gzip" destfile="target/parcels/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}-el7.parcel">
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin"/>
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf"/>
                                        </tar>
                                        <!-- sles11 -->
                                        <replace token="el7" value="sles11" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta">
                                            <include name="parcel.json"/>
                                        </replace>
                                        <tar compression="gzip" destfile="target/parcels/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}-sles11.parcel">
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin"/>
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf"/>
                                        </tar>
                                        <!-- precise -->
                                        <replace token="sles11" value="precise" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta">
                                            <include name="parcel.json"/>
                                        </replace>
                                        <tar compression="gzip" destfile="target/parcels/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}-precise.parcel">
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin"/>
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf"/>
                                        </tar>
                                        <!-- wheezy -->
                                        <replace token="precise" value="wheezy" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta">
                                            <include name="parcel.json"/>
                                        </replace>
                                        <tar compression="gzip" destfile="target/parcels/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}-wheezy.parcel">
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin"/>
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf"/>
                                        </tar>
                                        <!-- trusty -->
                                        <replace token="wheezy" value="trusty" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta">
                                            <include name="parcel.json"/>
                                        </replace>
                                        <tar compression="gzip" destfile="target/parcels/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}-trusty.parcel">
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin"/>
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf"/>
                                        </tar>
                                        <!-- xenial -->
                                        <replace token="trusty" value="xenial" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta">
                                            <include name="parcel.json"/>
                                        </replace>
                                        <tar compression="gzip" destfile="target/parcels/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}-xenial.parcel">
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin"/>
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/meta"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf"/>
                                        </tar>
                                        <exec executable="python2.7" failonerror="true" dir="target/parcels">
                                            <arg line="${project.build.directory}/classes/python/make_manifest.py"/>
                                        </exec>
                                    </target>
                                </configuration>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>installer</id>
            <activation>
                <property>
                    <name>installer</name>
                    <value>installer</value>
                </property>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <version>2.10</version>
                        <executions>
                            <execution>
                                <id>copy</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>copy-dependencies</goal>
                                </goals>
                                <configuration>
                                    <includeArtifactIds>
                                        db-client,
                                        db-tools-i18n,
                                        db-tools-ij,
                                        db-shared,
                                        db-drda,
                                        javax.servlet-api,
                                        javax.ws.rs-api,
                                        jython-standalone,
                                        splice_spark
                                    </includeArtifactIds>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-shade-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>1</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>shade</goal>
                                </goals>
                                <configuration>
                                    <artifactSet>
                                        <excludes>
                                            <exclude>org.apache.hadoop*:*</exclude>
                                            <exclude>org.apache.hadoop.hbase:*</exclude>
                                            <exclude>org.apache.hbase:*</exclude>
                                            <exclude>org.apache.hadoop.hbase.ipc:*</exclude>
                                            <exclude>org.apache.hbase.ipc:*</exclude>
                                            <exclude>org.apache.hadoop.hbase.filter:*</exclude>
                                            <exclude>org.apache.hbase.filter:*</exclude>
                                            <exclude>org.apache.hive:*</exclude>
                                            <exclude>org.apache.zookeeper:zookeeper</exclude>
                                            <exclude>org.apache.hive.shims:*</exclude>
                                            <exclude>com.amazonaws:*</exclude>
                                            <exclude>com.mapr*:*</exclude>
                                            <exclude>mapr.fs*:*</exclude>
                                            <exclude>com.sun.jersey:*</exclude>
                                            <exclude>com.splicemachine:db-client</exclude>
                                            <exclude>com.splicemachine:db-tools-i18n</exclude>
                                            <exclude>com.splicemachine:db-tools-ij</exclude>
                                            <exclude>com.splicemachine:db-shared</exclude>
                                            <exclude>com.splicemachine:db-drda</exclude>
                                            <exclude>org.apache.kafka:*</exclude>
                                            <exclude>org.python:jython-standalone</exclude>
                                        </excludes>
                                    </artifactSet>

                                    <relocations>
                                        <relocation>
                                            <pattern>com.fasterxml</pattern>
                                            <shadedPattern>splice.com.fasterxml</shadedPattern>
                                        </relocation>

                                        <relocation>
                                            <pattern>org.codehaus.jackson</pattern>
                                            <shadedPattern>splice.org.codehaus.jackson</shadedPattern>
                                        </relocation>

                                        <relocation>
                                            <pattern>org.jboss.netty</pattern>
                                            <shadedPattern>splice.org.jboss.netty</shadedPattern>
                                        </relocation>

                                        <relocation>
                                            <pattern>io.netty</pattern>
                                            <shadedPattern>org.spark_project.io.netty</shadedPattern>
                                        </relocation>

                                        <relocation>
                                            <pattern>javax.ws</pattern>
                                            <shadedPattern>splice.javax.ws</shadedPattern>
                                        </relocation>

                                    </relocations>
                                    <shadedArtifactAttached>true</shadedArtifactAttached>
                                    <shadedClassifierName>splice-uber</shadedClassifierName>
                                    <filters>
                                        <filter>
                                            <artifact>*:*</artifact>
                                            <excludes>
                                                <exclude>META-INF/maven/**</exclude>
                                                <exclude>META-INF/*.RSA</exclude>
                                                <exclude>META-INF/*.DSA</exclude>
                                                <exclude>META-INF/*.SF</exclude>
                                                <exclude>META-INF/licence/**</exclude>
                                                <exclude>**/core-site.xml</exclude>
                                                <exclude>**/hbase-site.xml</exclude>
                                                <exclude>**/splice-site.xml</exclude>
                                                <exclude>**/yarn-site.xml</exclude>
                                                <exclude>org/apache/spark/sql/execution/BufferedRowIterator</exclude>
                                            </excludes>
                                        </filter>

                                    </filters>
                                    <transformers>
                                        <transformer implementation="org.apache.maven.plugins.shade.resource.ServicesResourceTransformer"/>
                                    </transformers>

                                </configuration>
                            </execution>
                            <execution>
                                <id>2</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>shade</goal>
                                </goals>
                                <configuration>
                                    <artifactSet>
                                        <includes>
                                            <include>org.apache.hadoop:hadoop-yarn-server-web-proxy*</include>
                                        </includes>
                                    </artifactSet>
                                    <relocations>
                                        <relocation>
                                            <pattern>com.fasterxml</pattern>
                                            <shadedPattern>splice.com.fasterxml</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>org.jboss.netty</pattern>
                                            <shadedPattern>splice.org.jboss.netty</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>org.codehaus.jackson</pattern>
                                            <shadedPattern>splice.org.codehaus.jackson</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>io.netty</pattern>
                                            <shadedPattern>org.spark_project.io.netty</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>javax.ws</pattern>
                                            <shadedPattern>splice.javax.ws</shadedPattern>
                                        </relocation>
                                    </relocations>
                                    <shadedArtifactAttached>true</shadedArtifactAttached>
                                    <shadedClassifierName>splice-yarn-webproxy</shadedClassifierName>
                                    <filters>
                                        <filter>
                                            <artifact>*:*</artifact>
                                            <excludes>
                                                <exclude>META-INF/maven/**</exclude>
                                                <exclude>META-INF/*.RSA</exclude>
                                                <exclude>META-INF/*.DSA</exclude>
                                                <exclude>META-INF/*.SF</exclude>
                                                <exclude>META-INF/licence/**</exclude>
                                                <exclude>**/core-site.xml</exclude>
                                                <exclude>**/hbase-site.xml</exclude>
                                                <exclude>**/splice-site.xml</exclude>
                                                <exclude>**/yarn-site.xml</exclude>
                                                <exclude>org/apache/spark/sql/execution/BufferedRowIterator.class</exclude>
                                            </excludes>
                                        </filter>

                                    </filters>
                                    <transformers>
                                        <transformer implementation="org.apache.maven.plugins.shade.resource.ServicesResourceTransformer"/>
                                    </transformers>

                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions>
                            <execution>
                                <phase>pre-integration-test</phase>
                                <configuration>
                                    <target>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf">
                                            <fileset dir="target/classes/conf" includes="**/*"/>
                                        </copy>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin">
                                            <fileset dir="common/src/main/resources/bin" includes="**/*"/>
                                        </copy>
                                        <replace token="##SPLICELIBDIR##" value="${splice.lib.dir}" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin">
                                            <include name="sqlshell.sh"/>
                                        </replace>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts">
                                            <fileset dir="target/classes/scripts" includes="**/*" excludes="**/flatten.sh,**/restart.sh" />
                                            <fileset dir="common/src/main/resources/scripts" includes="**/*"/>
                                        </copy>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib">
                                            <fileset dir="target/dependency" includes="**/*"/>
                                        </copy>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib">
                                            <fileset dir="target/" includes="*splice-uber*"/>
                                        </copy>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib">
                                            <fileset dir="target/" includes="*splice-yarn-webproxy*"/>
                                        </copy>
                                        <move file="${project.build.directory}/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib/splice_machine-assembly-${project.version}-splice-uber.jar"
                                              tofile="${project.build.directory}/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib/splice_machine-assembly-uber.jar" />
                                        <move file="${project.build.directory}/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib/splice_machine-assembly-${project.version}-splice-yarn-webproxy.jar"
                                              tofile="${project.build.directory}/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib/splice_machine-assembly-yarn-webproxy.jar" />
                                        <tar compression="gzip" destfile="target/installer/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}.tar.gz">
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf"/>
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib"/>
                                        </tar>
                                    </target>
                                </configuration>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>hdp_service</id>
            <activation>
                <property>
                    <name>installer</name>
                    <value>installer</value>
                </property>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>copy</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>copy-dependencies</goal>
                                </goals>
                                <configuration>
                                    <includeArtifactIds>
                                        ${commonArtifacts},
                                        splice_ranger_admin,
                                        splice_ranger_service,
                                        splice_atlas
                                    </includeArtifactIds>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>rpm-maven-plugin</artifactId>
                        <version>2.1.5</version>
                        <executions>
                            <execution>
                                <id>generate-splice</id>
                                <goals>
                                    <goal>attached-rpm</goal>
                                </goals>
                                <configuration>
                                    <name>splicemachine</name>
                                    <targetOS>linux</targetOS>
                                    <classifier>splicemachine</classifier>
                                    <version>${envClassifier}.${project.version}.${parcel.patch}</version>
                                    <group>Applications/Internet</group>
                                    <license>Copyright © 2019 Splice Machine Inc. Licensed under the Apache License, Version 2.0.</license>
                                    <requires>
                                        <require>python > 2.6</require>
                                    </requires>
                                    <mappings>
                                        <mapping>
                                            <directory>/var/lib/splicemachine</directory>
                                            <sources>
                                                <source>
                                                    <location>${project.build.directory}/dependency</location>
                                                </source>
                                            </sources>
                                        </mapping>
                                        <mapping>
                                            <directory>/var/lib/splicemachine</directory>
                                            <sources>
                                                <source>
                                                    <location>common/src/main/resources/bin/sqlshell.sh</location>
                                                </source>
                                            </sources>
                                            <filemode>
                                                755
                                            </filemode>
                                            <directoryIncluded>
                                                false
                                            </directoryIncluded>
                                        </mapping>
                                    </mappings>
                                    <postinstallScriptlet>
                                      <script>sed -i 's/##SPLICELIBDIR##/\/var\/lib\/splicemachine/g' /var/lib/splicemachine/sqlshell.sh</script>
                                    </postinstallScriptlet>
                                </configuration>
                            </execution>
                            <execution>
                                <id>generate-ambari-service</id>
                                <goals>
                                    <goal>attached-rpm</goal>
                                </goals>
                                <configuration>
                                    <targetOS>linux</targetOS>
                                    <classifier>splicemachine_ambari_service</classifier>
                                    <name>splicemachine_ambari_service</name>
                                    <version>${envClassifier}.${project.version}.${parcel.patch}</version>
                                    <group>Applications/Internet</group>
                                    <license>Copyright © 2019 Splice Machine Inc. Licensed under the Apache License, Version 2.0.</license>
                                    <requires>
                                        <require>python > 2.6</require>
                                        <require>ambari-server > 2.2</require>
                                    </requires>
                                    <mappings>
                                        <mapping>
                                            <directory>/var/lib/ambari-server/resources/common-services/SPLICEMACHINE</directory>
                                            <sources>
                                                <source>
                                                    <location>${project.build.directory}/classes/common-services/SPLICEMACHINE</location>
                                                </source>
                                            </sources>
                                        </mapping>
                                        <mapping>
                                            <directory>/var/lib/ambari-server/resources/stacks/HDP/2.6/services/SPLICEMACHINE</directory>
                                            <sources>
                                                <source>
                                                    <location>${project.build.directory}/classes/stacks/HDP/2.6/services/SPLICEMACHINE</location>
                                                </source>
                                            </sources>
                                        </mapping>
                                    </mappings>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <profile>
            <id>maprpm</id>
            <activation>
                <property>
                    <name>maprpm</name>
                    <value>maprpm</value>
                </property>
            </activation>
            <dependencies>
                <!-- Extra dependencies needed for mapr to start -->
                <dependency>
                    <groupId>org.apache.hbase</groupId>
                    <artifactId>hbase-server</artifactId>
                    <version>${hbase.version}</version>
                </dependency>
                <dependency>
                    <groupId>org.apache.hbase</groupId>
                    <artifactId>hbase-it</artifactId>
                    <version>${hbase.version}</version>
                </dependency>
                <dependency>
                    <groupId>org.apache.hbase</groupId>
                    <artifactId>hbase-resource-bundle</artifactId>
                    <version>${hbase.bundle.version}</version>
                </dependency>
                <dependency>
                    <groupId>org.apache.hbase</groupId>
                    <artifactId>hbase-spark</artifactId>
                    <version>${assembly.spark}</version>
                    <exclusions>
                        <exclusion>
                            <groupId>org.scala-lang</groupId>
                            <artifactId>scala-library</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>org.apache.avro</groupId>
                            <artifactId>avro</artifactId>
                        </exclusion>
                    </exclusions>
                </dependency>
                <dependency>
                    <groupId>org.apache.hbase</groupId>
                    <artifactId>hbase-examples</artifactId>
                    <version>${hbase.version}</version>
                </dependency>
                <dependency>
                    <groupId>org.apache.hbase</groupId>
                    <artifactId>hbase-rest</artifactId>
                    <version>${hbase.version}</version>
                </dependency>
                <dependency>
                    <groupId>net.spy</groupId>
                    <artifactId>spymemcached</artifactId>
                    <version>2.11.6</version>
                </dependency>
                <dependency>
                    <groupId>com.sun.jersey.contribs</groupId>
                    <artifactId>jersey-guice</artifactId>
                    <version>1.9</version>
                </dependency>
                <dependency>
                    <groupId>org.apache.spark</groupId>
                    <artifactId>spark-sql_${scala.binary.version}</artifactId>
                    <version>${spark.version}</version>
                </dependency>
                <dependency>
                    <groupId>org.apache.spark</groupId>
                    <artifactId>spark-hive_${scala.binary.version}</artifactId>
                    <version>${spark.version}</version>
                </dependency>
            </dependencies>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>copy</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>copy-dependencies</goal>
                                </goals>
                                <configuration>
                                    <includeArtifactIds>
                                        ${commonArtifacts},
                                        splice_ranger_admin,
                                        splice_ranger_service,
                                        splice_atlas,
                                        javax.servlet-api,
                                        javax.ws.rs-api
                                    </includeArtifactIds>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-shade-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>1</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>shade</goal>
                                </goals>
                                <configuration>
                                    <artifactSet>
                                        <excludes>
                                            <exclude>org.apache.hadoop*:*</exclude>
                                            <exclude>org.apache.hadoop.hbase:*</exclude>
                                            <exclude>org.apache.hbase:*</exclude>
                                            <exclude>org.apache.hadoop.hbase.ipc:*</exclude>
                                            <exclude>org.apache.hbase.ipc:*</exclude>
                                            <exclude>org.apache.hadoop.hbase.filter:*</exclude>
                                            <exclude>org.apache.hbase.filter:*</exclude>
                                            <exclude>org.apache.hive:*</exclude>
                                            <exclude>org.apache.zookeeper:zookeeper</exclude>
                                            <exclude>org.apache.hive.shims:*</exclude>
                                            <exclude>com.amazonaws:*</exclude>
                                            <exclude>com.mapr*:*</exclude>
                                            <exclude>mapr.fs*:*</exclude>
                                            <exclude>com.sun.jersey:*</exclude>
                                            <exclude>com.splicemachine:db-client</exclude>
                                            <exclude>com.splicemachine:db-tools-i18n</exclude>
                                            <exclude>com.splicemachine:db-tools-ij</exclude>
                                            <exclude>com.splicemachine:db-shared</exclude>
                                            <exclude>com.splicemachine:db-drda</exclude>
                                            <exclude>org.apache.kafka:*</exclude>
                                            <exclude>org.python:jython-standalone</exclude>
                                        </excludes>
                                    </artifactSet>
                                    <relocations>
                                        <relocation>
                                            <pattern>com.fasterxml</pattern>
                                            <shadedPattern>splice.com.fasterxml</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>org.codehaus.jackson</pattern>
                                            <shadedPattern>splice.org.codehaus.jackson</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>org.jboss.netty</pattern>
                                            <shadedPattern>splice.org.jboss.netty</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>io.netty</pattern>
                                            <shadedPattern>org.spark_project.io.netty</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>javax.ws</pattern>
                                            <shadedPattern>splice.javax.ws</shadedPattern>
                                        </relocation>
                                    </relocations>
                                    <shadedArtifactAttached>true</shadedArtifactAttached>
                                    <shadedClassifierName>splice-uber</shadedClassifierName>
                                    <filters>
                                        <filter>
                                            <artifact>*:*</artifact>
                                            <excludes>
                                                <exclude>META-INF/maven/**</exclude>
                                                <exclude>META-INF/*.RSA</exclude>
                                                <exclude>META-INF/*.DSA</exclude>
                                                <exclude>META-INF/*.SF</exclude>
                                                <exclude>META-INF/licence/**</exclude>
                                                <exclude>**/core-site.xml</exclude>
                                                <exclude>**/hbase-site.xml</exclude>
                                                <exclude>**/splice-site.xml</exclude>
                                                <exclude>**/yarn-site.xml</exclude>
                                                <exclude>org/apache/spark/sql/execution/BufferedRowIterator</exclude>
                                            </excludes>
                                        </filter>
                                    </filters>
                                    <transformers>
                                        <transformer implementation="org.apache.maven.plugins.shade.resource.ServicesResourceTransformer"/>
                                    </transformers>
                                </configuration>
                            </execution>
                            <execution>
                                <id>2</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>shade</goal>
                                </goals>
                                <configuration>
                                    <artifactSet>
                                        <includes>
                                            <include>org.apache.hadoop:hadoop-yarn-server-web-proxy*</include>
                                        </includes>
                                    </artifactSet>
                                    <relocations>
                                        <relocation>
                                            <pattern>com.fasterxml</pattern>
                                            <shadedPattern>splice.com.fasterxml</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>org.jboss.netty</pattern>
                                            <shadedPattern>splice.org.jboss.netty</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>org.codehaus.jackson</pattern>
                                            <shadedPattern>splice.org.codehaus.jackson</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>io.netty</pattern>
                                            <shadedPattern>org.spark_project.io.netty</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>javax.ws</pattern>
                                            <shadedPattern>splice.javax.ws</shadedPattern>
                                        </relocation>
                                    </relocations>
                                    <shadedArtifactAttached>true</shadedArtifactAttached>
                                    <shadedClassifierName>splice-yarn-webproxy</shadedClassifierName>
                                    <filters>
                                        <filter>
                                            <artifact>*:*</artifact>
                                            <excludes>
                                                <exclude>META-INF/maven/**</exclude>
                                                <exclude>META-INF/*.RSA</exclude>
                                                <exclude>META-INF/*.DSA</exclude>
                                                <exclude>META-INF/*.SF</exclude>
                                                <exclude>META-INF/licence/**</exclude>
                                                <exclude>**/core-site.xml</exclude>
                                                <exclude>**/hbase-site.xml</exclude>
                                                <exclude>**/splice-site.xml</exclude>
                                                <exclude>**/yarn-site.xml</exclude>
                                                <exclude>org/apache/spark/sql/execution/BufferedRowIterator.class</exclude>
                                            </excludes>
                                        </filter>
                                    </filters>
                                    <transformers>
                                        <transformer implementation="org.apache.maven.plugins.shade.resource.ServicesResourceTransformer"/>
                                    </transformers>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>rpm-maven-plugin</artifactId>
                        <version>2.1.5</version>
                        <executions>
                            <execution>
                                <id>generate-splice-region</id>
                                <goals>
                                    <goal>attached-rpm</goal>
                                </goals>
                                <configuration>
                                    <name>splicemachine-${envClassifier}-region</name>
                                    <targetOS>linux</targetOS>
                                    <classifier>splicemachine</classifier>
                                    <version>${project.version}.${parcel.patch}</version>
                                    <group>Applications/Internet</group>
                                    <license>Copyright © 2019 Splice Machine Inc. Licensed under the Apache License, Version 2.0.</license>
                                    <mappings>
                                        <mapping>
                                            <directory>/etc/rc.d/init.d</directory>
                                            <configuration>true</configuration>
                                            <username>root</username>
                                            <groupname>root</groupname>
                                            <sources>
                                                <source>
                                                    <location>mapr/src/main/resources/scripts/service/splice-init-script</location>
                                                    <destination>splice-regionserver</destination>
                                                </source>
                                            </sources>
                                            <filemode>755</filemode>
                                        </mapping>
                                    </mappings>
                                    <cleanScriptlet>
                                        <script>rm -r %{buildroot}</script>
                                    </cleanScriptlet>
                                    <installScriptlet>
                                        <script>mkdir -p %{buildroot}/etc/rc.d/init.d/</script>
                                    </installScriptlet>
                                    <postinstallScriptlet>
                                        <script>chkconfig --add splice-regionserver</script>
                                    </postinstallScriptlet>
                                    <directoryIncluded>false</directoryIncluded>
                                </configuration>
                            </execution>
                            <execution>
                                <id>generate-splice-master</id>
                                <goals>
                                    <goal>attached-rpm</goal>
                                </goals>
                                <configuration>
                                    <name>splicemachine-${envClassifier}-master</name>
                                    <targetOS>linux</targetOS>
                                    <classifier>splicemachine</classifier>
                                    <version>${project.version}.${parcel.patch}</version>
                                    <group>Applications/Internet</group>
                                    <license>Copyright © 2019 Splice Machine Inc. Licensed under the Apache License, Version 2.0.</license>
                                    <mappings>
                                        <mapping>
                                            <directory>/etc/rc.d/init.d</directory>
                                            <configuration>true</configuration>
                                            <username>root</username>
                                            <groupname>root</groupname>
                                            <sources>
                                                <source>
                                                    <location>mapr/src/main/resources/scripts/service/splice-init-script</location>
                                                    <destination>splice-masterserver</destination>
                                                </source>
                                            </sources>
                                            <filemode>755</filemode>
                                        </mapping>
                                    </mappings>
                                    <cleanScriptlet>
                                        <script>rm -r %{buildroot}</script>
                                    </cleanScriptlet>
                                    <installScriptlet>
                                        <script>mkdir -p %{buildroot}/etc/rc.d/init.d/</script>
                                    </installScriptlet>
                                    <postinstallScriptlet>
                                        <script>chkconfig --add splice-masterserver</script>
                                    </postinstallScriptlet>
                                    <directoryIncluded>false</directoryIncluded>
                                </configuration>
                            </execution>
                            <execution>
                                <id>generate-splice-insecure</id>
                                <goals>
                                    <goal>attached-rpm</goal>
                                </goals>
                                <configuration>
                                    <name>splicemachine-${envClassifier}-hbase-conf</name>
                                    <targetOS>linux</targetOS>
                                    <classifier>splicemachine</classifier>
                                    <version>${project.version}.${parcel.patch}</version>
                                    <group>Applications/Internet</group>
                                    <license>Copyright © 2019 Splice Machine Inc. Licensed under the Apache License, Version 2.0.</license>
                                    <mappings>
                                        <mapping>
                                            <directory>/opt/mapr/conf</directory>
                                            <configuration>true</configuration>
                                            <username>mapr</username>
                                            <groupname>mapr</groupname>
                                            <sources>
                                                <source>
                                                    <location>mapr/src/main/resources/scripts/service/mapr-splice-hbase-config.sh</location>
                                                </source>
                                            </sources>
                                            <filemode>755</filemode>
                                            <directoryIncluded>false</directoryIncluded>
                                        </mapping>
                                        <mapping>
                                            <directory>/opt/mapr/hbase/${envHbase}-splice/bin</directory>
                                            <configuration>true</configuration>
                                            <username>mapr</username>
                                            <groupname>mapr</groupname>
                                            <sources>                                                
                                                <source>
                                                    <location>mapr/src/main/resources/scripts/service/hbase-daemon.sh</location>
                                                    <location>mapr/src/main/resources/bin/hbase</location>
                                                </source>
                                            </sources>
                                            <filemode>755</filemode>
                                        </mapping>
                                        <mapping>
                                            <directory>/opt/mapr/hbase/${envHbase}-splice/conf</directory>
                                            <configuration>true</configuration>
                                            <username>mapr</username>
                                            <groupname>mapr</groupname>
                                            <sources>
                                                <source>
                                                    <location>mapr/src/main/resources/scripts/splice/hbase-env.sh</location>
                                                </source>
                                                <source>
                                                    <location>mapr/src/main/resources/scripts/splice/hbase-site.conf.xml</location>
                                                    <destination>hbase-site.xml</destination>
                                                </source>
                                            </sources>
                                            <filemode>755</filemode>
                                        </mapping>
                                        <mapping>
                                            <directory>/opt/mapr/hbase/${envHbase}-splice/conf</directory>
                                            <configuration>true</configuration>
                                            <username>mapr</username>
                                            <groupname>mapr</groupname>
                                            <filemode>755</filemode>
                                        </mapping>
                                    </mappings>
                                    <cleanScriptlet>
                                        <script>rm -r %{buildroot}</script>
                                    </cleanScriptlet>
                                    <installScriptlet>
                                        <script>mkdir -p %{buildroot}/etc/rc.d/init.d/</script>
                                    </installScriptlet>
                                    <directoryIncluded>false</directoryIncluded>
                                </configuration>
                            </execution>
                            <execution>
                                <id>generate-splice-secure</id>
                                <goals>
                                    <goal>attached-rpm</goal>
                                </goals>
                                <configuration>
                                    <name>splicemachine-${envClassifier}-hbase-secure-conf</name>
                                    <targetOS>linux</targetOS>
                                    <classifier>splicemachine</classifier>
                                    <version>${project.version}.${parcel.patch}</version>
                                    <group>Applications/Internet</group>
                                    <license>Copyright © 2019 Splice Machine Inc. Licensed under the Apache License, Version 2.0.</license>
                                    <mappings>
                                        <mapping>
                                            <directory>/opt/mapr/conf</directory>
                                            <configuration>true</configuration>
                                            <username>mapr</username>
                                            <groupname>mapr</groupname>
                                            <sources>
                                                <source>
                                                    <location>mapr/src/main/resources/scripts/splice/mapr-splice-hbase-config.sh</location>
                                                </source>
                                            </sources>
                                            <filemode>755</filemode>
                                        </mapping>
                                        <mapping>
                                            <directory>/opt/mapr/hbase/${envHbase}-splice/bin</directory>
                                            <configuration>true</configuration>
                                            <username>mapr</username>
                                            <groupname>mapr</groupname>
                                            <sources>                                                
                                                <source>
                                                    <location>mapr/src/main/resources/scripts/service/hbase-daemon.sh</location>
                                                </source>
                                            </sources>
                                            <filemode>755</filemode>
                                        </mapping>
                                        <mapping>
                                            <directory>/opt/mapr/hbase/${envHbase}-splice/conf</directory>
                                            <configuration>true</configuration>
                                            <username>mapr</username>
                                            <groupname>mapr</groupname>
                                            <sources>
                                                <source>
                                                    <location>mapr/src/main/resources/scripts/splice/hbase-env.secure.sh</location>
                                                    <destination>hbase-env.sh</destination>
                                                </source>
                                                <source>
                                                    <location>mapr/src/main/resources/scripts/splice/hbase-site.secure.xml</location>
                                                    <destination>hbase-site.xml</destination>
                                                </source>
                                            </sources>
                                            <filemode>755</filemode>
                                        </mapping>
                                    </mappings>
                                    <cleanScriptlet>
                                        <script>rm -r %{buildroot}</script>
                                    </cleanScriptlet>
                                    <installScriptlet>
                                        <script>mkdir -p %{buildroot}/etc/rc.d/init.d/</script>
                                    </installScriptlet>
                                    <directoryIncluded>false</directoryIncluded>
                                </configuration>
                            </execution>
                            <execution>
                                <id>generate-splice-bin</id>
                                <goals>
                                    <goal>attached-rpm</goal>
                                </goals>
                                <configuration>
                                    <name>splicemachine-${envClassifier}-hbase-bin</name>
                                    <targetOS>linux</targetOS>
                                    <classifier>splicemachine</classifier>
                                    <version>${project.version}.${parcel.patch}</version>
                                    <group>Applications/Internet</group>
                                    <license>Copyright © 2019 Splice Machine Inc. Licensed under the Apache License, Version 2.0.</license>
                                    <mappings>=
                                        <mapping>
                                            <directory>/opt/splice/default/bin/</directory>
                                            <configuration>true</configuration>
                                            <username>mapr</username>
                                            <groupname>mapr</groupname>
                                            <sources>
                                                <source>
                                                    <location>mapr/src/main/resources/scripts/hbase/start-hbase.sh</location>
                                                </source>
                                                <source>
                                                    <location>mapr/src/main/resources/scripts/hbase/stop-hbase.sh</location>
                                                </source>
                                                <source>
                                                    <location>common/src/main/resources/bin/sqlshell.sh</location>
                                                </source>
                                            </sources>
                                            <filemode>755</filemode>
                                        </mapping>
                                        <mapping>
                                            <directory>/opt/splice/default/lib/</directory>
                                            <configuration>true</configuration>
                                            <username>mapr</username>
                                            <groupname>mapr</groupname>
                                            <dependency>
                                                <includes>
                                                    <include>com.splicemachine:db-client</include>
                                                    <include>com.splicemachine:db-drda</include>
                                                    <include>com.splicemachine:db-shared</include>
                                                    <include>com.splicemachine:db-tools-ij</include>
                                                    <include>com.splicemachine:splice_spark</include>
                                                    <include>tomcat:jasper-runtime</include>
                                                    <include>tomcat:tomcat-parent</include>
                                                    <include>org.apache.commons:commons-lang</include>
                                                    <include>org.apache.kafka:*</include>
                                                    <include>javax.servlet:javax.servlet-api:3.1.0</include>
                                                    <include>org.python:jython-standalone</include>
                                                    <include>org.mortbay.jetty:jetty</include>
                                                </includes>
                                            </dependency>
                                            <sources>
                                                <source>
                                                    <location>target</location>
                                                    <includes>
                                                        <include>*.jar</include>
                                                    </includes>
                                                </source>
                                            </sources>
                                            <filemode>755</filemode>
                                        </mapping>
                                        <mapping>
                                            <directory>/opt/mapr/hbase/${envHbase}-splice/bin</directory>
                                            <configuration>true</configuration>
                                            <username>mapr</username>
                                            <groupname>mapr</groupname>
                                            <sources>                                                
                                                <source>
                                                    <location>mapr/src/main/resources/bin</location>
                                                    <includes>
                                                        <include>*.sh</include>
                                                        <include>*.rb</include>
                                                        <include>hbase</include>
                                                        <include>hbase-jruby</include>
                                                    </includes>
                                                </source>
                                            </sources>
                                            <filemode>755</filemode>
                                        </mapping>
                                        <mapping>
                                            <directory>/opt/mapr/hbase/${envHbase}-splice/hbase-webapps</directory>
                                            <configuration>true</configuration>
                                            <username>mapr</username>
                                            <groupname>mapr</groupname>
                                            <sources>
                                                <source>
                                                     <location>mapr/src/main/resources/hbase-webapps</location>
                                                </source>
                                            </sources>
                                            <filemode>755</filemode>
                                        </mapping>
                                        <mapping>
                                            <directory>/opt/mapr/hbase/${envHbase}-splice/logs</directory>
                                            <configuration>true</configuration>
                                            <username>mapr</username>
                                            <groupname>mapr</groupname>
                                            <filemode>755</filemode>
                                        </mapping>
                                        <mapping>
                                            <directory>/opt/mapr/hbase/${envHbase}-splice/lib</directory>
                                            <configuration>true</configuration>
                                            <username>mapr</username>
                                            <groupname>mapr</groupname>
                                            <dependency>
                                                <excludes>
                                                    <exclude>org.mortbay.jetty:servlet-api</exclude>
                                                    <exclude>org.mortbay.jetty:servlet-api-2.5</exclude>
                                                </excludes>
                                            </dependency>
                                            <filemode>755</filemode>
                                            <sources>
                                                <softlinkSource>
                                                    <destination>servlet-api-2.5-6.1.14.jar</destination>
                                                    <location>/opt/splice/default/lib/javax.servlet-api-3.1.0.jar</location>
                                                </softlinkSource>
                                                <softlinkSource>
                                                    <destination>servlet-api-2.5.jar</destination>
                                                    <location>/opt/splice/default/lib/javax.servlet-api-3.1.0.jar</location>
                                                </softlinkSource>
                                            </sources>
                                        </mapping>
                                    </mappings>
                                    <cleanScriptlet>
                                        <script>rm -r %{buildroot}</script>
                                    </cleanScriptlet>
                                    <preinstallScriptlet>
                                        <script>mkdir -p %{buildroot}/etc/rc.d/init.d/</script>
                                    </preinstallScriptlet>
                                    <directoryIncluded>false</directoryIncluded>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <profile>
            <id>dbaas</id>
            <dependencies>
                <dependency>
                    <groupId>com.google.guava</groupId>
                    <artifactId>guava</artifactId>
                    <version>${guava.version}</version>
                </dependency>
            </dependencies>

            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <version>2.10</version>
                        <executions>
                            <execution>
                                <id>copy</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>copy-dependencies</goal>
                                </goals>
                                <configuration>
                                    <excludeArtifactIds>
                                        spark-avro_2.11
                                    </excludeArtifactIds>
                                    <includeArtifactIds>
                                        commonArtifacts,
                                        guava,
                                        snappy-java,
                                        kryo-shaded,
                                        kryo-serializers,
                                        db-client,
                                        db-tools-i18n,
                                        db-tools-ij,
                                        db-shared,
                                        db-drda,
                                        javax.servlet-api,
                                        javax.ws.rs-api,
                                        jython-standalone,
                                        splicemachine-${envClassifier}-${spark.version}_${scala.binary.version}
                                    </includeArtifactIds>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-shade-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>1</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>shade</goal>
                                </goals>
                                <configuration>
                                    <artifactSet>
                                        <excludes>
                                            <exclude>org.apache.hadoop*:*</exclude>
                                            <exclude>org.apache.hadoop.hbase:*</exclude>
                                            <exclude>org.apache.hbase:*</exclude>
                                            <exclude>org.apache.hadoop.hbase.ipc:*</exclude>
                                            <exclude>org.apache.hbase.ipc:*</exclude>
                                            <exclude>org.apache.hadoop.hbase.filter:*</exclude>
                                            <exclude>org.apache.hbase.filter:*</exclude>
                                            <exclude>org.apache.hive:*</exclude>
                                            <exclude>org.apache.zookeeper:zookeeper</exclude>
                                            <exclude>org.apache.hive.shims:*</exclude>
                                            <exclude>com.amazonaws:*</exclude>
                                            <exclude>com.mapr*:*</exclude>
                                            <exclude>mapr.fs*:*</exclude>
                                            <exclude>com.sun.jersey:*</exclude>
                                            <exclude>com.splicemachine:db-client</exclude>
                                            <exclude>com.splicemachine:db-tools-i18n</exclude>
                                            <exclude>com.splicemachine:db-tools-ij</exclude>
                                            <exclude>com.splicemachine:db-shared</exclude>
                                            <exclude>com.splicemachine:db-drda</exclude>
                                            <exclude>org.apache.kafka:*</exclude>
                                            <exclude>org.python:jython-standalone</exclude>
                                        </excludes>
                                    </artifactSet>

                                    <relocations>
                                        <relocation>
                                            <pattern>com.fasterxml</pattern>
                                            <shadedPattern>splice.com.fasterxml</shadedPattern>
                                        </relocation>

                                        <relocation>
                                            <pattern>org.codehaus.jackson</pattern>
                                            <shadedPattern>splice.org.codehaus.jackson</shadedPattern>
                                        </relocation>

                                        <relocation>
                                            <pattern>org.jboss.netty</pattern>
                                            <shadedPattern>splice.org.jboss.netty</shadedPattern>
                                        </relocation>

                                        <relocation>
                                            <pattern>io.netty</pattern>
                                            <shadedPattern>org.spark_project.io.netty</shadedPattern>
                                        </relocation>

                                        <relocation>
                                            <pattern>javax.ws</pattern>
                                            <shadedPattern>splice.javax.ws</shadedPattern>
                                        </relocation>

                                    </relocations>
                                    <shadedArtifactAttached>true</shadedArtifactAttached>
                                    <shadedClassifierName>splice-uber</shadedClassifierName>
                                    <filters>
                                        <filter>
                                            <artifact>*:*</artifact>
                                            <excludes>
                                                <exclude>META-INF/maven/**</exclude>
                                                <exclude>META-INF/*.RSA</exclude>
                                                <exclude>META-INF/*.DSA</exclude>
                                                <exclude>META-INF/*.SF</exclude>
                                                <exclude>META-INF/licence/**</exclude>
                                                <exclude>**/core-site.xml</exclude>
                                                <exclude>**/hbase-site.xml</exclude>
                                                <exclude>**/splice-site.xml</exclude>
                                                <exclude>**/yarn-site.xml</exclude>
                                                <exclude>org/apache/spark/sql/execution/BufferedRowIterator</exclude>
                                            </excludes>
                                        </filter>

                                    </filters>
                                    <transformers>
                                        <transformer implementation="org.apache.maven.plugins.shade.resource.ServicesResourceTransformer"/>
                                    </transformers>

                                </configuration>
                            </execution>
                            <execution>
                                <id>2</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>shade</goal>
                                </goals>
                                <configuration>
                                    <artifactSet>
                                        <includes>
                                            <include>org.apache.hadoop:hadoop-yarn-server-web-proxy*</include>
                                        </includes>
                                    </artifactSet>
                                    <relocations>
                                        <relocation>
                                            <pattern>com.fasterxml</pattern>
                                            <shadedPattern>splice.com.fasterxml</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>org.jboss.netty</pattern>
                                            <shadedPattern>splice.org.jboss.netty</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>org.codehaus.jackson</pattern>
                                            <shadedPattern>splice.org.codehaus.jackson</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>io.netty</pattern>
                                            <shadedPattern>org.spark_project.io.netty</shadedPattern>
                                        </relocation>
                                        <relocation>
                                            <pattern>javax.ws</pattern>
                                            <shadedPattern>splice.javax.ws</shadedPattern>
                                        </relocation>
                                    </relocations>
                                    <shadedArtifactAttached>true</shadedArtifactAttached>
                                    <shadedClassifierName>splice-yarn-webproxy</shadedClassifierName>
                                    <filters>
                                        <filter>
                                            <artifact>*:*</artifact>
                                            <excludes>
                                                <exclude>META-INF/maven/**</exclude>
                                                <exclude>META-INF/*.RSA</exclude>
                                                <exclude>META-INF/*.DSA</exclude>
                                                <exclude>META-INF/*.SF</exclude>
                                                <exclude>META-INF/licence/**</exclude>
                                                <exclude>**/core-site.xml</exclude>
                                                <exclude>**/hbase-site.xml</exclude>
                                                <exclude>**/splice-site.xml</exclude>
                                                <exclude>**/yarn-site.xml</exclude>
                                                <exclude>org/apache/spark/sql/execution/BufferedRowIterator.class</exclude>
                                            </excludes>
                                        </filter>

                                    </filters>
                                    <transformers>
                                        <transformer implementation="org.apache.maven.plugins.shade.resource.ServicesResourceTransformer"/>
                                    </transformers>

                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions>
                            <execution>
                                <phase>pre-integration-test</phase>
                                <configuration>
                                    <target>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin">
                                            <fileset dir="common/src/main/resources/bin" includes="**/*"/>
                                        </copy>
                                        <replace token="##SPLICELIBDIR##" value="${splice.lib.dir}" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin">
                                            <include name="sqlshell.sh"/>
                                        </replace>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf">
                                            <fileset dir="target/classes/conf" includes="**/*"/>
                                        </copy>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts">
                                            <fileset dir="target/classes/scripts" includes="**/*" excludes="**/flatten.sh,**/restart.sh" />
                                            <fileset dir="common/src/main/resources/scripts" includes="**/*"/>
                                        </copy>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib">
                                            <fileset dir="target/dependency" includes="**/*"/>
                                        </copy>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib">
                                            <fileset dir="target/" includes="*splice-uber*"/>
                                        </copy>
                                        <copy todir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib">
                                            <fileset dir="target/" includes="*splice-yarn-webproxy*"/>
                                        </copy>
                                        <move file="${project.build.directory}/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib/splice_machine-assembly-${project.version}-splice-uber.jar"
                                              tofile="${project.build.directory}/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib/splice_machine-assembly-uber.jar" />
                                        <move file="${project.build.directory}/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib/splice_machine-assembly-${project.version}-splice-yarn-webproxy.jar"
                                              tofile="${project.build.directory}/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib/splice_machine-assembly-yarn-webproxy.jar" />
                                        <tar compression="gzip" destfile="target/installer/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}.tar.gz">
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/bin"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/conf"/>
                                            <tarfileset username="root" group="root" filemode="755" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/scripts"/>
                                            <tarfileset username="root" group="root" filemode="644" dir="target/SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib" prefix="SPLICEMACHINE-${project.version}.${envClassifier}.${parcel.patch}/lib"/>
                                        </tar>
                                    </target>
                                </configuration>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <profile>
            <id>sqlshell</id>
            <activation>
                <property>
                    <name>installer</name>
                    <value>installer</value>
                </property>
            </activation>
            <build>
                <plugins>
                  <plugin>
                      <groupId>org.apache.maven.plugins</groupId>
                      <artifactId>maven-dependency-plugin</artifactId>
                      <version>2.10</version>
                      <executions>
                          <execution>
                              <id>copy-dependencies</id>
                              <phase>package</phase>
                              <goals>
                                  <goal>copy</goal>
                              </goals>
                              <configuration>
                                  <artifactItems>
                                    <artifactItem>
                                      <groupId>com.splicemachine</groupId>
                                      <artifactId>db-client</artifactId>
                                      <version>${project.parent.version}</version>
                                      <type>jar</type>
                                    </artifactItem>
                                    <artifactItem>
                                      <groupId>com.splicemachine</groupId>
                                      <artifactId>db-tools-ij</artifactId>
                                      <version>${project.parent.version}</version>
                                      <type>jar</type>
                                    </artifactItem>
                                  </artifactItems>
                                  <outputDirectory>${project.build.directory}/sqlshell/lib</outputDirectory>
                              </configuration>
                          </execution>
                      </executions>
                  </plugin>
                  <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-resources-plugin</artifactId>
                    <version>3.1.0</version>
                    <executions>
                      <execution>
                        <id>copy-sqlshell</id>
                        <phase>package</phase>
                        <goals>
                          <goal>copy-resources</goal>
                        </goals>
                        <configuration>
                          <outputDirectory>${project.build.directory}/sqlshell/</outputDirectory>
                          <resources>
                            <resource>
                                <directory>common/src/main/resources/bin</directory>
                                <includes>
                                  <include>sqlshell.sh</include>
                                </includes>
                            </resource>
                          </resources>
                        </configuration>
                      </execution>
                    </executions>
                  </plugin>
                  <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-jar-plugin</artifactId>
                    <executions>
                        <execution>
                            <id>default-jar</id>
                            <configuration>
                                <classifier>${envClassifier}</classifier>
                            </configuration>
                        </execution>
                    </executions>
                  </plugin>
                </plugins>
            </build>
        </profile>

        <profile>
            <id>standalone</id>
            <dependencies>
                <dependency>
                    <groupId>org.apache.spark</groupId>
                    <artifactId>spark-network-yarn_${scala.binary.version}</artifactId>
                    <version>2.4.4</version>
                    <scope>test</scope>
                </dependency>
            </dependencies>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>copy</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>copy-dependencies</goal>
                                </goals>
                                <configuration>
                                    <includeArtifactIds>
                                        ${commonArtifacts},
                                        spark-network-yarn_${scala.binary.version}
                                    </includeArtifactIds>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-assembly-plugin</artifactId>
                        <configuration>
                            <descriptor>${basedir}/src/assembly/standalone.xml</descriptor>
                            <finalName>SPLICEMACHINE-${project.version}</finalName>
                        </configuration>
                        <executions>
                            <execution>
                                <id>make-standalone-assembly</id>
                                <phase>package</phase>
                                <goals>
                                    <goal>single</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

    </profiles>
</project>
